<!DOCTYPE html>
<html lang="en">
<!-- HEAD -->
<%- include('../partials/head')  %> 
<!-- END HEAD -->
<body class="forms perfilUser">
<!-- HEADER -->
<%- include('../partials/header') %> 
<!-- END HEADER -->

<!-- MAIN -->
<main>

    <div class="perfilH1">
        <h1>AJUSTES DE LA CUENTA</h1>
        <p>Administra la cuenta que has compartido con Funko e incluye tu nombre, dirección de contacto y más.</p>
    </div>
    <div class="contendor-avatar">
        <div class="imgUser" id="img-preview">
        <% if (typeof session.user != "undefined") { %>
            <img src="/img/users/<%= session.user.icon %>" alt="Foto de perfil de <%= session.user.name  %> ">
        <% } %> 
        </div>
        <form action="/usuarios/perfil/icon?_method=PUT" method="post" enctype="multipart/form-data" id="formIcon">
            <div class="inputFile">
                <span>Subir imagen</span>
                <input type="file" name="icon" id="icon">
            </div>        
            <button type="submit"><i class="fa-solid fa-pen-to-square"></i></button>
        </form>
        <small class="text-danger" id="fileErrors"><%=(locals.errors && errors.icon) ? errors.icon.msg : "" %> </small>
        <small class="text-danger" id="formIconErrors"></small>
    </div>

    <div class="contenedor-nameUser">
        <div>
            <input type="text" name="userName" id="userName" placeholder="<%= user.userName %>" disabled>
            <button class="btnOpenPop-up"><i class="fa-solid fa-pen-to-square"></i></button>
        </div>
        <div>
            <input type="text" name="address" id="address" placeholder="AGREGAR DIRECCIÓN" disabled>
            <button id="btnPopOpen"><i class="fa-solid fa-location-dot"></i></button>
        </div>
    </div>
    
    <div class="contenedor-datos">
        <div class="perfilh4">
            <h5>DATOS PERSONALES</h5>
            <p>Administra tu nombre y dirección. Estos datos personales son privados y no se mostrarán a otros usuarios. Consulta nuestra <a href="/enlaces-utiles/politicas-de-privacidad">política de privacidad</a> </p>
            <small class="text-danger" id="datosErrors"><%= (locals.errors && errors.custom) ? errors.custom.msg : "" %></small>
        </div>
        <form action="/usuarios/perfil/datos?_method=PUT" method="POST" id="formDatos">
            <div class="nom_ape-container">
                <div>
                    <input type="text" name="name" id="name" value="<%= (locals.old && old.name) ? old.name : user.name %>">
                    <small class="text-danger" id="errorsName"><%=(locals.errors && errors.name) ? errors.name.msg : "" %> </small>
                </div>
                <div>
                    <input type="text" name="lastName" id="lastName" value="<%=user.lastName%>">
                    <small class="text-danger" id="errorsLastName"><%=(locals.errors && errors.lastName) ? errors.lastName.msg : "" %> </small>
                </div>
            </div>
            <div class="pais_tel-contenedor">
                <select class="selec-container" name="province" id="province">
                    <% for( const oneProvince of provinces) { %>
                        <option value="<%= oneProvince %>" <%= (locals.oldData && (oneProvince === oldData.provinces)) || user.province === oneProvince ? 'selected' : null %> > <%= oneProvince %> </option>
                    <% } %>


                </select>
                <div>
                    <input class="input-style" placeholder="Celular" type="tel" name="phone" id="phone" value="<%=user.phone%>">
                    <small class="text-danger" id="errorsPhone"><%= (locals.errors && errors.phone)? errors.phone.msg : "" %> </small>
                </div> <!-- falta validar -->
            </div>
            <div class="btn-cambios">
                <button class="btnDelete" type="reset">DESCARTAR LOS CAMBIOS</button>
                <button class="btnSubmit" type="submit">GUARDAR CAMBIOS</button>
            </div>
        </form>
    </div>
    <% if (user.addresses) { %>
        <div class="tableAddress">
            <table class="table table-hover">
                <h5>MIS DIRECCIONES</h5>
                <thead>
                    <tr>
                        <th>Provincia</th>
                        <th>Calle</th>
                        <th>Ciudad</th>
                        <th>Número</th>
                        <th>Depto</th>
                        <th>Cod. Postal</th>
                        <th>Timbre</th>
                        <th>Eliminar</th>
                    </tr>
                </thead>
                <tbody>
                  <% user.addresses.forEach(address => { %>
                  <tr>
                    <td><%- user.province %></td>
                    <td><%- address.address %></td>
                    <td><%- address.city %></td>
                    <td><%- address.number %></td>
                    <td><%- address.departament %></td>
                    <td><%- address.postal_code %></td>
                    <td><%- address.doorbell %></td>
                    <td>
                      <form action="/usuarios/direcciones/<%- address.id %>?_method=DELETE" method="POST">
                        <button class="btn btn-outline-danger" type="submit">Eliminar</button>
                      </form>
                    </td>
                  </tr>
                  <% }) %>
                </tbody>
              </table>
        </div>
    <% } %>

    <div class="overlay">
        <div class="pop-up">
            <div class="squareLogo">
                <a href="" class="closePop-up"><i class="fas fa-times"></i></a>
                <img src="/img/productos/Logo.svg" alt="Logo Funko">
            </div>
            <article>
                <h5>Confirmar el cambio de nombre de usuario</h5>
                <p><b>Aviso:</b> Si cambias el nombre de pantalla de Funko, no puedes volver a cambiarlo durante 2 semanas luego de confirmar este cambio.</p>
                <b>Nombre en pantalla actual: <%  %></b>
            </article>
            <form action="/usuarios/perfil/nombres?_method=PUT" method="POST">
                <div class="input">
                    <input type="text" placeholder="Nuevo nombre de usuario" name="userName" id="userName" value="<%=user.userName%>">
                </div>
                <small class="text-danger" id="errorsUserName"><%= (locals.errors && errors.userName)? errors.userName.msg : "" %> </small>
                <button class="btnSubmit" type="submit">CONFIRMAR</button>
            </form>
        </div>
    </div>

    <div class="overlay" id="overlay">
        <div class="pop-up" id="pop-up">
            <div class="squareLogo">
                <a href="" class="closePop-up" id="closePop-up"><i class="fas fa-times"></i></a>
                <img src="/img/productos/Logo.svg" alt="Logo Funko">
            </div>
            <article>
                <h5>Agregar más direcciones donde estoy ubicado</h5>
                <p><b>Aviso:</b> Podras administrar todas tus direcciones donde lleguen los pedidos de nuestro e-shop.</p>
            </article>
            <div class="contenedor-direccion">
                <form action="/usuarios/direcciones" method="POST">
                    <div class="contenedor-address">
                        <div class="input-container">
                            <input class="input-style" placeholder="Dirección" type="text" name="address" id="address">
                            <input class="input-style" placeholder="Ciudad" type="text" name="city" id="city">
                        </div>
                    </div>
                    <div class="contenedor-bottom">
                        <div class="input-barrio">
                            <input class="input-style" placeholder="Número" type="text" name="number" id="number">
                            <input class="input-style" placeholder="Código postal" type="text" name="postal_code" id="postal_code">
                            <input class="input-style" placeholder="Departamento" type="text" name="departament" id="departament">
                            <input class="input-style" placeholder="Timbre" type="text" name="doorbell" id="doorbell">
                        </div>
                    </div>
                    <button class="btnSubmit" type="submit">CONFIRMAR</button>
                </form>
            </div>
        </div>
    </div>
</main>
<!-- END MAIN -->

<!-- FOOTER -->
<%- include('../partials/footer')  %> 
<!-- END FOOTER -->
<script src="../js/overlay.js"></script>
<script src="../js/users/profileValidations.js" defer></script>
</body>
</html>